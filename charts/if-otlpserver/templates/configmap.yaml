apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "if-otlpserver.fullname" . }}
  name: {{ printf "%s-config-cm" (include "if-otlpserver.fullname" .) }}
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "if-otlpserver.labels" . | nindent 4 }}
data:
  data.yaml: |-
{{ .Values.config.data | indent 4 }}

  server.yaml: |-
    # InsightFinder Engine URL
    insightFinderUrl: {{ .Values.config.server.insightFinderUrl | default  "https://stg.insightfinder.com" }}
    # The gRPC server listen port
    port: {{ .Values.config.server.port | default 4317 }}

    # TLS/SSL settings.
    tls:
      enabled: {{ .Values.config.server.tls.enabled | default false }}

      # Path to full-chain certificate file (PEM)
      certificateFile: {{ .Values.config.server.tls.certificateFile | default "" }}

      # Path to the private key file.
      privateKeyFile: {{ .Values.config.server.tls.privateKeyFile | default "" }}

    # Worker Thread Configurations.
    worker:
      # DataProcess worker: Extracting information from the original data.
      processThreads: {{ .Values.config.server.worker.processThreads | default 1 }}

      # Streaming worker: Send data to InsightFinder.
      streamingThreads: {{ .Values.config.server.worker.streamingThreads | default 1 }}
      streamingBatchSize: {{ .Values.config.server.worker.streamingBatchSize | default 100 }}
